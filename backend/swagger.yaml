swagger: "2.0"
info:
  title: KnightWise
  description: |
    API documentation for KnightWise, the computer science guided learning platform.

    ## Question Types and Grading
    
    KnightWise supports five non-programming question types, each with its own grading algorithm:
    
    ### Multiple Choice
    - **Input Format**: String (e.g., `"Paris"`)
    - **Grading**: Exact match (case-insensitive, trimmed)
    - **Normalized Score**: 1.0 (correct) or 0.0 (incorrect)
    
    ### Fill-In-the-Blanks
    - **Input Format**: String (e.g., `"Paris"`)
    - **Grading**: Exact or fuzzy matching using Levenshtein distance
    - **Normalized Score**: 0.0 to 1.0 based on similarity (1 - distance/maxLength)
    - **Partial Credit**: Yes (>= 50% similarity, API feedback says "Almost correct!")
    
    ### Select-All-That-Apply
    - **Input Format**: Array of strings (e.g., `["Python", "JavaScript"]`)
    - **Grading**: (correct selections - incorrect selections) / total correct options
    - **Normalized Score**: 0.0 to 1.0 based on how many correct selections
    - **Partial Credit**: Yes
    
    ### Ranked Choice
    - **Input Format**: Array of strings in ranked order (e.g., `["First", "Second", "Third"]`)
    - **Grading**: Kendall tau distance (counts pairwise inversions)
    - **Normalized Score**: 0.0 to 1.0, based on 1.0 - (inversions / maxInversions)
    - **Partial Credit**: Yes
    
    ### Drag-and-Drop
    - **Input Format**: Object mapping items to placements (e.g., `{"item": "category"}`)
    - **Grading**: Correct placements / total items
    - **Normalized Score**: 0.0 to 1.0
    - **Partial Credit**: Yes
    
    ## Scoring System
    
    All graders return a **normalized score** (0.0 to 1.0) which is multiplied by the question's point value to calculate points earned.

  version: 1.0.0
  contact:
    email: da606808@ucf.edu
    
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

paths:
  /dashboard:
    get:
      tags:
        - Authentication
      summary: Access the dashboard (protected route).
      operationId: getDashboard
      description: Retrieves user-specific dashboard data. Requires authentication via a valid JSON Web Token.
      security:
        - BearerAuth: []
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        403:
          description: Forbidden
        404:
          description: URL Not Found
        500:
          description: Server Error
  
  /auth/login:
    post:
      tags:
        - Users
      summary: Login user.
      operationId: doLogin
      description: Allows a user with a valid account to log into the application. Generates a JSON Web Token.
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: loginItem
        description: Login credentials.
        schema:
          $ref: '#/definitions/Login'
      responses:
        200:
          description: OK
        400:
          description: Bad Request
        404:
          description: URL Not Found
        500:
          description: Server Error
  
  /auth/signup:
    post:
      tags:
      - Users
      summary: Register user.
      operationId: signupUser
      description: Registers a new KnightPrep user. Requires email verification.
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: signupItem
        description: User registration details.
        schema:
          $ref: '#/definitions/SignUp'
      responses:
        201:
          description: Created
        400:
          description: Bad Request
        404:
          description: URL Not Found
        500:
          description: Server Error
          
  /auth/sendotp:
    post:
      tags:
      - Authentication
      summary: Send user one-time password.
      operationId: sendOtp
      description: Sends a one-time password to the user's email for account verification during signup.
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: sendOtpItem
        description: OTP sending details.
        schema:
          $ref: '#/definitions/SendOTP'
      responses:
        200:
          description: OK
        400:
          description: Bad Request
        404:
          description: URL Not Found
        500:
          description: Server Error
  
  /auth/verify:
    post:
      tags:
      - Authentication
      summary: Verify the one-time password.
      operationId: doVerify
      description: Validates the one-time password provided by the user during signup, ensuring it is correct and not expired.
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: verifyItem
        description: OTP verification details.
        schema:
          $ref: '#/definitions/Verify'
      responses:
        200:
          description: OK
        400:
          description: Bad Request
        404:
          description: URL Not Found
        500:
          description: Server Error
  
  /auth/resetPassword:
    post:
      tags:
      - Users
      summary: Reset user password.
      operationId: doResetPassword
      description: Allows a user to reset their account password.
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: resetItem
        description: Password reset details.
        schema:
          $ref: '#/definitions/ResetPassword'
      responses:
        200:
          description: OK
        403:
          description: Forbidden
        404:
          description: URL Not Found
        500:
          description: Server Error

  /profauth/signup:
    post:
      tags:
      - Professors
      summary: Register professor.
      operationId: signupProfessor
      description: Registers a new professor account. Requires email OTP verification first. Account is created with VERIFIED = 0 and requires admin approval before login is permitted.
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: signupItem
        description: Professor registration details.
        schema:
          $ref: '#/definitions/SignUp'
      responses:
        201:
          description: Created
        400:
          description: Bad Request
        500:
          description: Server Error

  /profauth/login:
    post:
      tags:
      - Professors
      summary: Login professor.
      operationId: loginProfessor
      description: Authenticates a verified professor and returns a JWT with professor role attached. Unverified professors will receive 403.
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: loginItem
        description: Login credentials.
        schema:
          $ref: '#/definitions/Login'
      responses:
        200:
          description: OK
        400:
          description: Bad Request
        403:
          description: Forbidden - Account pending admin verification
        500:
          description: Server Error

  /profauth/resetPassword:
    post:
      tags:
      - Professors
      summary: Reset professor password.
      operationId: resetProfessorPassword
      description: Resets a professor's password after email OTP verification. Uses the shared /auth/sendotp and /auth/verify endpoints.
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: resetItem
        description: Password reset details.
        schema:
          $ref: '#/definitions/ResetPassword'
      responses:
        200:
          description: OK
        400:
          description: Bad Request
        403:
          description: Forbidden - Email not verified
        404:
          description: Professor Not Found
        500:
          description: Server Error

  /admin/createquestion:
    post:
      tags:
      - Admins
      - Professors
      summary: Create a question.
      operationId: createQuestion
      description: Creates a new question and its associated answer objects. Accessible by admin key or verified professor JWT. Professors can only submit questions under their own owner ID regardless of what is passed in.
      security:
        - BearerAuth: []
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: questionItem
        description: Question and answer details.
        schema:
          $ref: '#/definitions/CreateQuestion'
      responses:
        201:
          description: Created
        400:
          description: Bad Request
        401:
          description: Unauthorized
        403:
          description: Forbidden
        500:
          description: Server Error

  /admin/problems/{id}:
    get:
      tags:
      - Admins
      - Professors
      summary: Fetch question by ID.
      operationId: getAdminProblemById
      description: Fetches a question and its associated answers by ID. Accessible by admin key or verified professor JWT.
      security:
        - BearerAuth: []
      parameters:
      - name: id
        in: path
        required: true
        type: integer
        description: The unique ID of the question.
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        403:
          description: Forbidden
        404:
          description: Question Not Found
        500:
          description: Server Error
    delete:
      tags:
      - Admins
      summary: Delete question by ID.
      operationId: deleteQuestion
      description: Deletes a question and all associated answers and responses. Admin only.
      security:
        - BearerAuth: []
      parameters:
      - name: id
        in: path
        required: true
        type: integer
        description: The unique ID of the question.
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        404:
          description: Question Not Found
        500:
          description: Server Error

  /admin/users/{id}:
    delete:
      tags:
      - Admins
      summary: Delete user by ID.
      operationId: deleteUser
      description: Deletes a user account and all associated data. Admin only.
      security:
        - BearerAuth: []
      parameters:
      - name: id
        in: path
        required: true
        type: integer
        description: The unique ID of the user.
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        404:
          description: User Not Found
        500:
          description: Server Error

  /admin/createuser:
    post:
      tags:
      - Admins
      summary: Create a user bypassing verification.
      operationId: createUser
      description: Allows an admin to create a user account directly, bypassing email OTP verification. Admin only.
      security:
        - BearerAuth: []
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: signupItem
        description: User registration details.
        schema:
          $ref: '#/definitions/SignUp'
      responses:
        201:
          description: Created
        400:
          description: Bad Request
        401:
          description: Unauthorized
        500:
          description: Server Error

  /admin/getuser:
    get:
      tags:
      - Admins
      summary: Fetch user by ID or username.
      operationId: getUser
      description: Fetches a user by either their ID or username. Provide exactly one query parameter. Admin only.
      security:
        - BearerAuth: []
      parameters:
      - name: id
        in: query
        required: false
        type: integer
        description: The unique ID of the user.
      - name: username
        in: query
        required: false
        type: string
        description: The username of the user.
      responses:
        200:
          description: OK
        400:
          description: Bad Request - Provide username OR id, not both
        401:
          description: Unauthorized
        404:
          description: User Not Found
        500:
          description: Server Error

  /admin/unverifiedprofs:
    get:
      tags:
      - Admins
      summary: Fetch unverified professors.
      operationId: getUnverifiedProfs
      description: Returns a list of all professor accounts pending admin verification. Admin only.
      security:
        - BearerAuth: []
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        500:
          description: Server Error

  /admin/verifyprof/{id}:
    post:
      tags:
      - Admins
      summary: Verify a professor by ID.
      operationId: verifyProfessor
      description: Sets a professor's VERIFIED flag to true, allowing them to log in. Sends a verification approval email to the professor. Admin only.
      security:
        - BearerAuth: []
      parameters:
      - name: id
        in: path
        required: true
        type: integer
        description: The unique ID of the professor.
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        404:
          description: Professor Not Found
        500:
          description: Server Error
  
  /test/topic/{topicName}:
    get:
      tags:
      - Problems
      summary: Fetch questions for a specific topic.
      operationId: getTopicQuestions
      description: Retrieves all questions for a given subcategory (e.g., Backtracking, Recursion).
      security:
        - BearerAuth: []
      parameters:
      - name: topicName
        in: path
        required: true
        type: string
        description: The name of the topic/subcategory (e.g. Backtracking).
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        404:
          description: Topic Not Found
        500:
          description: Server Error
  
  /test/mocktest:
    get:
      tags:
      - Problems
      summary: Generate a mock test.
      operationId: getMockTest
      description: Retrieves a randomly generated mock test with questions from all sections (A, B, C, D).
      security:
        - BearerAuth: []
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        404:
          description: Questions Not Found
        500:
          description: Server Error
  
  /test/submit:
    post:
      tags:
      - Problems
      summary: Submit answer to a question.
      operationId: submitAnswer
      description: |
        Submits user's answer to a question, grades it based on question type, and records the response. Supports multiple question types: Multiple Choice, Fill-In-the-Blanks, Select-All-That-Apply, Ranked Choice, and Drag-and-Drop.
      security:
        - BearerAuth: []
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: submitItem
        description: Answer submission details.
        schema:
          $ref: '#/definitions/SubmitAnswer'
      responses:
        201:
          description: Answer submitted successfully
          schema:
            $ref: '#/definitions/SubmitResponse'
        400:
          description: Bad Request
        401:
          description: Unauthorized
        404:
          description: Question Not Found
        500:
          description: Server Error
          
  /problems/{id}:
    get:
      tags:
      - Problems
      summary: Fetch problem by its ID.
      operationId: getProblemById
      description: Retrieves a practice problem by its ID.
      parameters:
      - name: id
        in: path
        required: true
        type: string
        description: The unique ID of the problem.
      responses:
        200:
          description: OK
        404:
          description: URL Not Found
        500:
          description: Server Error
  
  /progress/graph:
    get:
      tags:
      - Users
      summary: Fetch user progress data for graph.
      operationId: getGraphData
      description: Retrieves user performance data for a radar chart visualization.
      security:
        - BearerAuth: []
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        404: 
          description: URL Not Found
        500:
          description: Server Error
  
  /progress/history:
    get:
      tags:
      - Users
      summary: Fetch user problem history.
      operationId: getHistory
      description: Retrieves the history of problems solved by the user in a paginated format.
      security:
        - BearerAuth: []
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        404:
          description: URL Not Found
        500:
          description: Server Error
  
  /progress/messageData:
    get:
      tags:
      - Users
      summary: Fetch user progress message data.
      operationId: getMessage
      description: Generates a message that recommends practice topics and records the user's streak.
      security:
        - BearerAuth: []
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        404:
          description: URL Not Found
        500:
          description: Server Error
          
securityDefinitions:
  BearerAuth:
    type: apiKey
    name: Authorization
    in: header
    description: "Include the token in the Authorization header as 'Bearer your-token'"

definitions:
  Login:
    type: object
    required:
    - username
    - password
    properties:
      username:
        type: string
        example: "RickL"
      password:
        type: string
        example: "COP4331"
  
  SignUp:
    type: object
    required:
    - username
    - password
    - email
    - firstName
    - lastName
    properties:
      username:
        type: string
        example: "RickL"
      password:
        type: string
        example: "COP4331"
      email:
        type: string
        example: "rickl4331@hotmail.com"
      firstName:
        type: string
        example: "Rick"
      lastName:
        type: string
        example: "Leinecker"
  
  SendOTP:
    type: object
    required:
    - email
    - purpose
    properties:
      email:
        type: string
        example: "danlandsman@gmail.com"
      purpose:
        type: string
        example: "reset"
  
  Verify:
    type: object
    required:
    - email
    - otp
    properties:
      email:
        type: string
        example: "test123@yahoo.com"
      otp:
        type: integer
        example: 856923
  
  ResetPassword:
    type: object
    required:
    - email
    - password
    properties:
      email:
        type: string
        example: "johndoe64@aol.com"
      password:
        type: string
        example: "newPass123!"

  CreateQuestion:
    type: object
    required:
    - type
    - author_exam_id
    - section
    - category
    - subcategory
    - points_possible
    - question_text
    - answer_text
    - answer_correctness
    - answer_rank
    - answer_placement
    properties:
      type:
        type: string
        example: "Multiple Choice"
      author_exam_id:
        type: string
        example: "KnightWise"
      section:
        type: string
        example: "DSN"
      category:
        type: string
        example: "Programming"
      subcategory:
        type: string
        example: "Python"
      points_possible:
        type: number
        example: 5.0
      question_text:
        type: string
        example: "What is Python's print function?"
      owner_id:
        type: integer
        example: null
        description: Owner professor ID. Ignored for professor requests â€” always forced to the requesting professor's own ID.
      answer_text:
        type: array
        items:
          type: string
        example: ["print", "printf", "println", "put"]
      answer_correctness:
        type: array
        items:
          type: integer
        example: [1, 0, 0, 0]
        description: Which answer_text is considered a correct answer.
      answer_rank:
        type: array
        items:
          type: integer
        example: [1, 2, 3, 4]
        description: Correct ranking of answer_text options. Only used in Ranked Choice questions.
      answer_placement:
        type: array
        items:
          type: string
        example: ["a", "b", "c", "d"]
        description: Correct placement field for each of answer_text options. Only used in Drag and Drop questions.
  
  SubmitAnswer:
    type: object
    required:
    - problem_id
    - userAnswer
    - category
    - topic
    properties:
      problem_id:
        type: integer
        example: 42
        description: The unique ID of the question being answered.
      userAnswer:
        description: "User's answer. Format varies by question type: string for Multiple Choice/Fill In Blanks, array of strings for Select All/Ranked Choice, object for Drag-and-Drop."
        example: "Paris"
      category:
        type: string
        example: "Programming Languages"
        description: The category of the question.
      topic:
        type: string
        example: "I/O"
        description: The subcategory/topic of the question.
  
  SubmitResponse:
    type: object
    properties:
      message:
        type: string
        example: "Answer submitted"
      isCorrect:
        type: boolean
        example: true
        description: Whether the answer was completely correct.
      pointsEarned:
        type: number
        example: 3.5
        description: Points earned for this answer (supports partial credit).
      pointsPossible:
        type: number
        example: 5
        description: Maximum points possible for this question.
      normalizedScore:
        type: number
        example: 0.7
        description: Score as a decimal from 0.0 to 1.0.
      feedback:
        type: string
        example: "Correct!"
        description: Feedback message explaining the result.

host: www.knightwise.dev
basePath: /api
schemes:
  - https