swagger: "2.0"
info:
  title: KnightWise
  description: |
    API documentation for KnightWise, the computer science guided learning platform.

    ## Question Types and Grading
    
    KnightWise supports five non-programming question types, each with its own grading algorithm:
    
    ### Multiple Choice
    - **Input Format**: String (e.g., `"Paris"`)
    - **Grading**: Exact match (case-insensitive, trimmed)
    - **Normalized Score**: 1.0 (correct) or 0.0 (incorrect)
    
    ### Fill-In-the-Blanks
    - **Input Format**: String (e.g., `"Paris"`)
    - **Grading**: Exact or fuzzy matching using Levenshtein distance
    - **Normalized Score**: 0.0 to 1.0 based on similarity (1 - distance/maxLength)
    - **Partial Credit**: Yes (>= 50% similarity, API feedback says "Almost correct!")
    
    ### Select-All-That-Apply
    - **Input Format**: Array of strings (e.g., `["Python", "JavaScript"]`)
    - **Grading**: (correct selections - incorrect selections) / total correct options
    - **Normalized Score**: 0.0 to 1.0 based on how many correct selections
    - **Partial Credit**: Yes
    
    ### Ranked Choice
    - **Input Format**: Array of strings in ranked order (e.g., `["First", "Second", "Third"]`)
    - **Grading**: Kendall tau distance (counts pairwise inversions)
    - **Normalized Score**: 0.0 to 1.0, based on 1.0 - (inversions / maxInversions)
    - **Partial Credit**: Yes
    
    ### Drag-and-Drop
    - **Input Format**: Object mapping items to placements (e.g., `{"item": "category"}`)
    - **Grading**: Correct placements / total items
    - **Normalized Score**: 0.0 to 1.0
    - **Partial Credit**: Yes
    
    ## Scoring System
    
    All graders return a **normalized score** (0.0 to 1.0) which is multiplied by the question's point value to calculate points earned.

  version: 1.0.0
  contact:
    email: da606808@ucf.edu
    
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

paths:
  /dashboard:
    get:
      tags:
        - Authentication
      summary: Access the dashboard (protected route).
      operationId: getDashboard
      description: Retrieves user-specific dashboard data. Requires authentication via a valid JSON Web Token.
      security:
        - BearerAuth: []
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        403:
          description: Forbidden
        404:
          description: URL Not Found
        500:
          description: Server Error
  
  /auth/login:
    post:
      tags:
        - Users
      summary: Login user.
      operationId: doLogin
      description: Allows a user with a valid account to log into the application. Generates a JSON Web Token.
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: loginItem
        description: Login credentials.
        schema:
          $ref: '#/definitions/Login'
      responses:
        200:
          description: OK
        400:
          description: Bad Request
        404:
          description: URL Not Found
        500:
          description: Server Error
  
  /auth/signup:
    post:
      tags:
      - Users
      summary: Register user.
      operationId: signupUser
      description: Registers a new KnightPrep user. Requires email verification.
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: signupItem
        description: User registration details.
        schema:
          $ref: '#/definitions/SignUp'
      responses:
        201:
          description: Created
        400:
          description: Bad Request
        404:
          description: URL Not Found
        500:
          description: Server Error
          
  /auth/sendotp:
    post:
      tags:
      - Authentication
      summary: Send user one-time password.
      operationId: sendOtp
      description: Sends a one-time password to the user's email for account verification during signup.
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: sendOtpItem
        description: OTP sending details.
        schema:
          $ref: '#/definitions/SendOTP'
      responses:
        200:
          description: OK
        400:
          description: Bad Request
        404:
          description: URL Not Found
        500:
          description: Server Error
  
  /auth/verify:
    post:
      tags:
      - Authentication
      summary: Verify the one-time password.
      operationId: doVerify
      description: Validates the one-time password provided by the user during signup, ensuring it is correct and not expired.
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: verifyItem
        description: OTP verification details.
        schema:
          $ref: '#/definitions/Verify'
      responses:
        200:
          description: OK
        400:
          description: Bad Request
        404:
          description: URL Not Found
        500:
          description: Server Error
  
  /auth/resetPassword:
    post:
      tags:
      - Users
      summary: Reset user password.
      operationId: doResetPassword
      description: Allows a user to reset their account password.
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: resetItem
        description: Password reset details.
        schema:
          $ref: '#/definitions/ResetPassword'
      responses:
        200:
          description: OK
        403:
          description: Forbidden
        404:
          description: URL Not Found
        500:
          description: Server Error

  /code/submitCode:
    post:
      tags:
      - Problems
      summary: Submit or test code against a programming question.
      operationId: submitCode
      description: |
        Submits code to Judge0 for execution. Supports two modes:
        - **Graded Submission** (`isTestRun: false`): Runs code against all test cases, grades the result, and records the response. Counts toward the daily submission limit (10/day).
        - **Test Run** (`isTestRun: true`): Runs code against only the first test case and returns raw output without grading or saving a response. Limited to 3 runs per problem per day.
      security:
        - BearerAuth: []
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: submitCodeItem
        description: Code submission details.
        schema:
          $ref: '#/definitions/SubmitCode'
      responses:
        200:
          description: OK
        400:
          description: Bad Request
        401:
          description: Unauthorized
        404:
          description: Question or Test Cases Not Found
        429:
          description: Submission or Test Run Limit Exceeded
        500:
          description: Server Error
        502:
          description: Judge0 Service Unavailable
  
  /test/topic/{topicName}:
    get:
      tags:
      - Problems
      summary: Fetch questions for a specific topic.
      operationId: getTopicQuestions
      description: Retrieves all questions for a given subcategory (e.g., Backtracking, Recursion).
      security:
        - BearerAuth: []
      parameters:
      - name: topicName
        in: path
        required: true
        type: string
        description: The name of the topic/subcategory (e.g. Backtracking).
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        404:
          description: Topic Not Found
        500:
          description: Server Error
  
  /test/mocktest:
    get:
      tags:
      - Problems
      summary: Generate a mock test.
      operationId: getMockTest
      description: Retrieves a randomly generated mock test with questions from all sections (A, B, C, D).
      security:
        - BearerAuth: []
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        404:
          description: Questions Not Found
        500:
          description: Server Error
  
  /test/submit:
    post:
      tags:
      - Problems
      summary: Submit answer to a question.
      operationId: submitAnswer
      description: |
        Submits user's answer to a question, grades it based on question type, and records the response. Supports multiple question types: Multiple Choice, Fill-In-the-Blanks, Select-All-That-Apply, Ranked Choice, and Drag-and-Drop.
      security:
        - BearerAuth: []
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: submitItem
        description: Answer submission details.
        schema:
          $ref: '#/definitions/SubmitAnswer'
      responses:
        201:
          description: Answer submitted successfully
          schema:
            $ref: '#/definitions/SubmitResponse'
        400:
          description: Bad Request
        401:
          description: Unauthorized
        404:
          description: Question Not Found
        500:
          description: Server Error
          
  /problems/{id}:
    get:
      tags:
      - Problems
      summary: Fetch problem by its ID.
      operationId: getProblemById
      description: Retrieves a practice problem by its ID.
      parameters:
      - name: id
        in: path
        required: true
        type: string
        description: The unique ID of the problem.
      responses:
        200:
          description: OK
        404:
          description: URL Not Found
        500:
          description: Server Error
  
  /progress/graph:
    get:
      tags:
      - Users
      summary: Fetch user progress data for graph.
      operationId: getGraphData
      description: Retrieves user performance data for a radar chart visualization.
      security:
        - BearerAuth: []
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        404: 
          description: URL Not Found
        500:
          description: Server Error
  
  /progress/history:
    get:
      tags:
      - Users
      summary: Fetch user problem history.
      operationId: getHistory
      description: Retrieves the history of problems solved by the user in a paginated format.
      security:
        - BearerAuth: []
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        404:
          description: URL Not Found
        500:
          description: Server Error
  
  /progress/messageData:
    get:
      tags:
      - Users
      summary: Fetch user progress message data.
      operationId: getMessage
      description: Generates a message that recommends practice topics and records the user's streak.
      security:
        - BearerAuth: []
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        404:
          description: URL Not Found
        500:
          description: Server Error
          
securityDefinitions:
  BearerAuth:
    type: apiKey
    name: Authorization
    in: header
    description: "Include the token in the Authorization header as 'Bearer your-token'"

definitions:
  Login:
    type: object
    required:
    - username
    - password
    properties:
      username:
        type: string
        example: "RickL"
      password:
        type: string
        example: "COP4331"
  
  SignUp:
    type: object
    required:
    - username
    - password
    - email
    - firstName
    - lastName
    properties:
      username:
        type: string
        example: "RickL"
      password:
        type: string
        example: "COP4331"
      email:
        type: string
        example: "rickl4331@hotmail.com"
      firstName:
        type: string
        example: "Rick"
      lastName:
        type: string
        example: "Leinecker"
  
  SendOTP:
    type: object
    required:
    - email
    - purpose
    properties:
      email:
        type: string
        example: "danlandsman@gmail.com"
      purpose:
        type: string
        example: "reset"
  
  Verify:
    type: object
    required:
    - email
    - otp
    properties:
      email:
        type: string
        example: "test123@yahoo.com"
      otp:
        type: integer
        example: 856923
  
  ResetPassword:
    type: object
    required:
    - email
    - password
    properties:
      email:
        type: string
        example: "johndoe64@aol.com"
      password:
        type: string
        example: "newPass123!"

  SubmitCode:
    type: object
    required:
    - problemId
    - code
    - languageId
    - isTestRun
    properties:
      problemId:
        type: integer
        example: 42
        description: The unique ID of the programming question.
      code:
        type: string
        example: "print('Hello World')"
        description: The code to execute.
      languageId:
        type: integer
        example: 71
        description: Judge0 language ID for the submitted code.
      isTestRun:
        type: boolean
        example: false
        description: If true, runs against first test case only without grading or saving. If false, runs full graded submission.
  
  SubmitAnswer:
    type: object
    required:
    - problem_id
    - userAnswer
    - category
    - topic
    properties:
      problem_id:
        type: integer
        example: 42
        description: The unique ID of the question being answered.
      userAnswer:
        description: "User's answer. Format varies by question type: string for Multiple Choice/Fill In Blanks, array of strings for Select All/Ranked Choice, object for Drag-and-Drop."
        example: "Paris"
      category:
        type: string
        example: "Programming Languages"
        description: The category of the question.
      topic:
        type: string
        example: "I/O"
        description: The subcategory/topic of the question.
  
  SubmitResponse:
    type: object
    properties:
      message:
        type: string
        example: "Answer submitted"
      isCorrect:
        type: boolean
        example: true
        description: Whether the answer was completely correct.
      pointsEarned:
        type: number
        example: 3.5
        description: Points earned for this answer (supports partial credit).
      pointsPossible:
        type: number
        example: 5
        description: Maximum points possible for this question.
      normalizedScore:
        type: number
        example: 0.7
        description: Score as a decimal from 0.0 to 1.0.
      feedback:
        type: string
        example: "Correct!"
        description: Feedback message explaining the result.

host: www.knightwise.dev
basePath: /api
schemes:
  - https